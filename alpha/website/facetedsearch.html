<!DOCTYPE html>
<html>

<head>




    <link href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" rel="stylesheet"/>

    <title>Earthcube</title>

    <link rel="stylesheet" href="./css/spacelab/bootstrap.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script  src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/underscore@1.12.0/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.0.0/js-yaml.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mocha/1.0.2/package/lib/browser/fs.js"></script>
    <script src="js/facetedsearch.js"></script>
    <script type="module" src="./js/geocodes_facets.js"></script>
    <script type="module" src="./js/toolsregistry/rr_toolask.js"></script>

    <link rel="stylesheet" href="css/main.css"/>
</head>

<body>
<div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <a class="navbar-brand" href="https://www.earthcube.org/">
            <img src="images/EarthCube-White-Long-Tagline.png" height="30"
                 class="d-inline-block align-top" alt="EarthCube" loading="lazy">

        </a>
        <!-- -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <form class="input-group form-inline  w-50 ">
            <input id="q" class="form-control w-25 ml-sm-2" type="search" placeholder="Search" aria-label="Search">
            <div class="input-group-append">
                <a href="#" class="btn btn-default" id="searchBtn">
                    <img src="./images/icons/search.svg" alt="" width="32" height="32" title="Search">
                </a>
            </div>
            <input style="visibility: hidden" id="nn" type="number" min="5" max="200" step="5" value="20"/>
        </form>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <ul class="navbar-nav mr-auto">

                <li class="nav-item">
                    <a class="nav-link" href="#">Help</a>
                </li>
            </ul>

        </div>
    </nav>


    <div id="wrapper row">
        <div id="description">
            <h3>Faceted Search of EarthCube resources</h3>

        </div>
    </div>
    <!-- Here comes the demo, if you want to copy and paste, start here -->
    <div class="row col-12" id="filterDiv"> <!-- filters -->
        <div class="row col-3 align-items-start">
            <div id="facets" class="row col-12">

            </div>


        </div>
        <div class="row col-8 align-self-start ">
            <div id="heading" class="row col-12" style="height: 2em;"></div>
            <div id="results" class="row col-12"></div>
        </div>
    </div>
</div>


<script>


    document.querySelector('#searchBtn').addEventListener('click', search);
    $( "#q" ).keypress (function( event ) {
        if ( event.which == 13 ) {
            search(event);
        }
    });
    function search(e) {
        // (async () => {
        let q = $('#q').val();

        getItemsFromSparql(q).then(function (results) {
            $.facetsettings.items = results;
            //$.facetUpdate();
            $.facetelize($.facetsettings);
        });
        updateURL(q,"all", true);
        // });
    };
    // document.querySelector('.collapse').addEventListener('show.bs.collapse', _handleCollapse);
    // document.querySelector('.collapse').addEventListener('hide.bs.collapse', _handleExpand);

    function _handleCollapse(e) {
        console.log("collapse");

        // Toggle plus minus icon on show hide of collapse element
        $(this).find(".fa").removeClass("fa-plus").addClass("fa-minus")


    };

    function _handleExpand(e) {
        console.log("expand");

        // Toggle plus minus icon on show hide of collapse element
        $(this).find(".fa").removeClass("fa-minus").addClass("fa-plus");
    };

    function updateURL(q, s,  push) {
        console.log("UpdateURL Called");

        let params = new URLSearchParams(location.search.slice(1));
        params.set('q', q);
        params.set('searchTypes', s);


        // Issues with current browsers and titles
        //document.title = `Search:${q}&n=${n}&o=${o}`;

        //window.history.replaceState({}, '', location.pathname + '?' + params);
        const state = {
            q: q,
            searchTypes: s,

        }
        if (push) {
            window.history.pushState(state, 'GeoDex Search', location.pathname + '?' + params);
        }

    }
</script>
</div>
<a href="http://github.com/eikes/facetedsearch"><img style="position: absolute; top: 0; right: 0; border: 0;"
                                                     src="https://a248.e.akamai.net/assets.github.com/img/7afbc8b248c68eb468279e8c17986ad46549fb71/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
                                                     alt="Fork me on GitHub"></a>
</body>
</html>
